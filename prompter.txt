18|caraon- | üìö Documenta√ß√£o da API dispon√≠vel em: http://localhost:3030/api-docs
18|caraon- | üîó Novo cliente WebSocket conectado

18|caraon-api  | ‚ñ∂Ô∏è Teste de playground recebido para a inst√¢ncia: 6886205236771eb0a30adf06
18|caraon-api  | -- In√≠cio da Execu√ß√£o Hier√°rquica: Inst√¢ncia 6886205236771eb0a30adf06 --
18|caraon-api  | Mensagem do usu√°rio: "como ser empresario"
18|caraon-api  | 1. Buscando Agente Roteador...
18|caraon-api  | >> getParentAgent: Buscando agente ROUTER para inst√¢ncia 6886205236771eb0a30adf06 e organiza√ß√£o N/A
18|caraon-api  | >> getParentAgent: Agente ROUTER encontrado: 688776ac5154351404a6547f
18|caraon-api  |  -> Roteador encontrado: Roteador - Whatsapp de Saide (ID: 688776ac5154351404a6547f)
18|caraon-api  | 2. Roteador selecionando o departamento...
18|caraon-api  | >> getOrganizationParentAgents: Buscando agentes PARENT para a inst√¢ncia 6886205236771eb0a30adf06
18|caraon-api  | >> getOrganizationParentAgents: 0 agentes PARENT encontrados.
18|caraon-api  | Nenhum departamento (agente PARENT) encontrado. O roteador principal responder√° diretamente.
18|caraon-api  | >> executeAgentDirect: Executando agente Roteador - Whatsapp de Saide (ID: 688776ac5154351404a6547f) diretamente.
18|caraon-api  | >> executeAgentDirect: Prompt: Voc√™ √© o agente roteador principal. Sua fun√ß√£o √© analisar a mensagem do usu√°rio e direcion√°-la para o departamento ou especialista correto (Vendas, Suporte, etc.). Se n√£o tiver certeza, pe√ßa ao usu√°rio para esclarecer.
18|caraon-api  | Mensagem do usu√°rio: "como ser empresario"
18|caraon-api  | >> generateResponse: Iniciando a gera√ß√£o de resposta...
18|caraon-api  | >> generateResponse: Prompt: Voc√™ √© o agente roteador principal. Sua fun√ß√£o √© analisar a mensagem do usu√°rio e direcion√°-la para o departamento ou especialista correto (Vendas, Suporte, etc.). Se n√£o tiver certeza, pe√ßa ao usu√°rio para esclarecer.
18|caraon-api  | Mensagem do usu√°rio: "como ser empresario"
18|caraon-api  | >> generateResponse: Config: {
18|caraon-api  |   id: '688776ac5154351404a65480',
18|caraon-api  |   agentId: '688776ac5154351404a6547f',
18|caraon-api  |   maxTokens: 2000,
18|caraon-api  |   temperature: 0.7,
18|caraon-api  |   model: 'googleai/gemini-2.0-flash',
18|caraon-api  |   systemPrompt: 'Voc√™ √© um agente orquestrador que delega tarefas para agentes especializados.',
18|caraon-api  |   fallbackMessage: 'Desculpe, n√£o consegui processar sua solicita√ß√£o no momento.',
18|caraon-api  |   timeoutSeconds: 30,
18|caraon-api  |   maxRetries: 3
18|caraon-api  | }
18|caraon-api  | >> generateResponse: Erro detalhado ao gerar resposta com Genkit: TypeError: llmResponse.text is not a function
18|caraon-api  |     at generateResponse (file:///root/CaraON-backend/src/services/genkit.service.js:36:38)
18|caraon-api  |     at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
18|caraon-api  |     at async executeAgentDirect (file:///root/CaraON-backend/src/services/agent.execution.service.js:161:20)
18|caraon-api  |     at async executeHierarchicalAgentFlow (file:///root/CaraON-backend/src/services/agent.execution.service.js:38:32)
18|caraon-api  |     at async WebSocket.<anonymous> (file:///root/CaraON-backend/src/services/websocket.service.js:52:33)
18|caraon-api  | !! ERRO na execu√ß√£o hier√°rquica: Falha ao se comunicar com o modelo de linguagem. {
18|caraon-api  |   stack: 'Error: Falha ao se comunicar com o modelo de linguagem.\n' +
18|caraon-api  |     '    at generateResponse (file:///root/CaraON-backend/src/services/genkit.service.js:41:11)\n' +
18|caraon-api  |     '    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)\n' +
18|caraon-api  |     '    at async executeAgentDirect (file:///root/CaraON-backend/src/services/agent.execution.service.js:161:20)\n' +
18|caraon-api  |     '    at async executeHierarchicalAgentFlow (file:///root/CaraON-backend/src/services/agent.execution.service.js:38:32)\n' +
18|caraon-api  |     '    at async WebSocket.<anonymous> (file:///root/CaraON-backend/src/services/websocket.service.js:52:33)'
18|caraon-api  | }
18|caraon-api  | >> logAgentExecution: Registrando execu√ß√£o... {
18|caraon-api  |   routerAgentId: '688776ac5154351404a6547f',
18|caraon-api  |   success: false,
18|caraon-api  |   errorMessage: 'Falha ao se comunicar com o modelo de linguagem.'
18|caraon-api  | }
18|caraon-api  | >> logAgentExecution: Execu√ß√£o registrada com sucesso. ID: 6887af5459c66939aad4a1b7
18|caraon-api  | -- Fim da Execu√ß√£o: FALHA. Tempo total: 1873ms --
18|caraon-api  | Erro ao processar mensagem do WebSocket: Error: Falha ao se comunicar com o modelo de linguagem.
18|caraon-api  |     at executeHierarchicalAgentFlow (file:///root/CaraON-backend/src/services/agent.execution.service.js:98:23)
18|caraon-api  |     at async WebSocket.<anonymous> (file:///root/CaraON-backend/src/services/websocket.service.js:52:33) {
18|caraon-api  |   executionId: '6887af5459c66939aad4a1b7'
18|caraon-api  | }























