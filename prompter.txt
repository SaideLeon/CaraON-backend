ubuntu@cognick:~$ sudo su -
root@cognick:~# cd CaraON-backend
root@cognick:~/CaraON-backend# npm install

added 1 package, removed 37 packages, and audited 555 packages in 1s

73 packages are looking for funding
  run `npm fund` for details

5 high severity vulnerabilities

To address all issues (including breaking changes), run:
  npm audit fix --force

Run `npm audit` for details.
root@cognick:~/CaraON-backend# pm2 logs 18
[TAILING] Tailing last 15 lines for [18] process (change the value with --lines option)
/root/.pm2/logs/caraon-api-out.log last 15 lines:
18|caraon- | ‚úÖ Conectado ao MongoDB para sess√µes WhatsApp
18|caraon- | üîÑ Verificando inst√¢ncias para reconex√£o autom√°tica...
18|caraon- | üöÄ API e WebSocket rodando na porta 3030
18|caraon- | üìö Documenta√ß√£o da API dispon√≠vel em: http://localhost:3030/api-docs
18|caraon- | Found 1 instances to reconnect.
18|caraon- | ‚ñ∂Ô∏è Iniciando reconex√£o para a inst√¢ncia: Whats TI (687d6b9e14ab6c1c2623ae4a-1753994425635)
18|caraon- | üöÄ Iniciando inst√¢ncia 687d6b9e14ab6c1c2623ae4a-1753994425635. √â uma reconex√£o? true
18|caraon- | Status da inst√¢ncia 687d6b9e14ab6c1c2623ae4a-1753994425635 atualizado para: RECONNECTING
18|caraon- | ‚úÖ Inst√¢ncia WhatsApp 687d6b9e14ab6c1c2623ae4a-1753994425635 conectada!
18|caraon- | Status da inst√¢ncia 687d6b9e14ab6c1c2623ae4a-1753994425635 atualizado para: CONNECTED
18|caraon- | ‚úÖ Inst√¢ncia WhatsApp 687d6b9e14ab6c1c2623ae4a-1753994425635 conectada!
18|caraon- | Status da inst√¢ncia 687d6b9e14ab6c1c2623ae4a-1753994425635 atualizado para: CONNECTED
18|caraon- | ‚úâÔ∏è  Mensagem recebida para 687d6b9e14ab6c1c2623ae4a-1753994425635:
18|caraon- | ‚úâÔ∏è  Mensagem recebida para 687d6b9e14ab6c1c2623ae4a-1753994425635:
18|caraon- | ‚úâÔ∏è  Mensagem recebida para 687d6b9e14ab6c1c2623ae4a-1753994425635: Ol√°

/root/.pm2/logs/caraon-api-error.log last 15 lines:
18|caraon- |   executionId: '6890d84371de84988c0e54dd'
18|caraon- | }
18|caraon- | Erro ao processar mensagem do WhatsApp: Error: Nenhum agente roteador principal ativo encontrado para a inst√¢ncia 688bd4b9516de24d08819190.
18|caraon- |     at executeHierarchicalAgentFlow (file:///root/CaraON-backend/src/services/agent.execution.service.js:88:13)
18|caraon- |     at async _handleIncomingWhatsAppMessage (file:///root/CaraON-backend/src/services/whatsapp.service.js:88:44) {
18|caraon- |   executionId: '6890d84371de84988c0e54de'
18|caraon- | }
18|caraon- | Erro no fluxo de execu√ß√£o do agente (Execution ID: 6890d84771de84988c0e54df): Error: Nenhum agente roteador principal ativo encontrado para a inst√¢ncia 688bd4b9516de24d08819190.
18|caraon- |     at executeHierarchicalAgentFlow (file:///root/CaraON-backend/src/services/agent.execution.service.js:88:13)
18|caraon- |     at async _handleIncomingWhatsAppMessage (file:///root/CaraON-backend/src/services/whatsapp.service.js:88:44)
18|caraon- | Erro ao processar mensagem do WhatsApp: Error: Nenhum agente roteador principal ativo encontrado para a inst√¢ncia 688bd4b9516de24d08819190.
18|caraon- |     at executeHierarchicalAgentFlow (file:///root/CaraON-backend/src/services/agent.execution.service.js:88:13)
18|caraon- |     at async _handleIncomingWhatsAppMessage (file:///root/CaraON-backend/src/services/whatsapp.service.js:88:44) {
18|caraon- |   executionId: '6890d84771de84988c0e54df'
18|caraon- | }

^C
root@cognick:~/CaraON-backend# npm install

up to date, audited 555 packages in 1s

73 packages are looking for funding
  run `npm fund` for details

5 high severity vulnerabilities

To address all issues (including breaking changes), run:
  npm audit fix --force

Run `npm audit` for details.
root@cognick:~/CaraON-backend# npm audit fix --force
npm warn using --force Recommended protections disabled.
npm warn audit Updating whatsapp-web.js to 1.23.0, which is a SemVer major change.
npm warn deprecated puppeteer@13.7.0: < 22.8.2 is no longer supported

added 3 packages, removed 4 packages, changed 6 packages, and audited 554 packages in 3s

73 packages are looking for funding
  run `npm fund` for details

# npm audit report

tar-fs  2.0.0 - 2.1.2
Severity: high
tar-fs Vulnerable to Link Following and Path Traversal via Extracting a Crafted tar File - https://github.com/advisories/GHSA-pq67-2wwv-3xjx
tar-fs can extract outside the specified dir with a specific tarball - https://github.com/advisories/GHSA-8cj5-5rvv-wf4v
fix available via `npm audit fix --force`
Will install whatsapp-web.js@1.31.0, which is outside the stated dependency range
node_modules/whatsapp-web.js/node_modules/tar-fs
  puppeteer  10.0.0 - 18.1.0
  Depends on vulnerable versions of tar-fs
  Depends on vulnerable versions of ws
  node_modules/whatsapp-web.js/node_modules/puppeteer
    whatsapp-web.js  1.14.0 - 1.23.1-alpha.5 || >=1.31.1-alpha.0
    Depends on vulnerable versions of puppeteer
    node_modules/whatsapp-web.js

ws  8.0.0 - 8.17.0
Severity: high
ws affected by a DoS when handling a request with many HTTP headers - https://github.com/advisories/GHSA-3h5v-q93c-6h6q
fix available via `npm audit fix --force`
Will install whatsapp-web.js@1.31.0, which is outside the stated dependency range
node_modules/whatsapp-web.js/node_modules/ws

4 high severity vulnerabilities

To address all issues, run:
  npm audit fix --force
root@cognick:~/CaraON-backend# npm audit fix --force
npm warn using --force Recommended protections disabled.
npm warn deprecated puppeteer@18.2.1: < 22.8.2 is no longer supported

added 3 packages, removed 2 packages, changed 6 packages, and audited 555 packages in 2s

73 packages are looking for funding
  run `npm fund` for details

# npm audit report

tar-fs  2.0.0 - 2.1.2
Severity: high
tar-fs Vulnerable to Link Following and Path Traversal via Extracting a Crafted tar File - https://github.com/advisories/GHSA-pq67-2wwv-3xjx
tar-fs can extract outside the specified dir with a specific tarball - https://github.com/advisories/GHSA-8cj5-5rvv-wf4v
fix available via `npm audit fix`
node_modules/whatsapp-web.js/node_modules/tar-fs
  puppeteer-core  10.0.0 - 22.11.1
  Depends on vulnerable versions of tar-fs
  Depends on vulnerable versions of ws
  node_modules/whatsapp-web.js/node_modules/puppeteer-core
    puppeteer  18.2.0 - 20.1.1
    Depends on vulnerable versions of puppeteer-core
    node_modules/whatsapp-web.js/node_modules/puppeteer
      whatsapp-web.js  1.23.1-alpha.0 - 1.31.1-alpha.0
      Depends on vulnerable versions of puppeteer
      node_modules/whatsapp-web.js

ws  8.0.0 - 8.17.0
Severity: high
ws affected by a DoS when handling a request with many HTTP headers - https://github.com/advisories/GHSA-3h5v-q93c-6h6q
fix available via `npm audit fix`
node_modules/whatsapp-web.js/node_modules/ws

5 high severity vulnerabilities

To address all issues, run:
  npm audit fix
root@cognick:~/CaraON-backend# npm audit fix

up to date, audited 555 packages in 1s

73 packages are looking for funding
  run `npm fund` for details

# npm audit report

tar-fs  2.0.0 - 2.1.2
Severity: high
tar-fs Vulnerable to Link Following and Path Traversal via Extracting a Crafted tar File - https://github.com/advisories/GHSA-pq67-2wwv-3xjx
tar-fs can extract outside the specified dir with a specific tarball - https://github.com/advisories/GHSA-8cj5-5rvv-wf4v
fix available via `npm audit fix`
node_modules/whatsapp-web.js/node_modules/tar-fs
  puppeteer-core  10.0.0 - 22.11.1
  Depends on vulnerable versions of tar-fs
  Depends on vulnerable versions of ws
  node_modules/whatsapp-web.js/node_modules/puppeteer-core
    puppeteer  18.2.0 - 20.1.1
    Depends on vulnerable versions of puppeteer-core
    node_modules/whatsapp-web.js/node_modules/puppeteer
      whatsapp-web.js  1.23.1-alpha.0 - 1.31.1-alpha.0
      Depends on vulnerable versions of puppeteer
      node_modules/whatsapp-web.js

ws  8.0.0 - 8.17.0
Severity: high
ws affected by a DoS when handling a request with many HTTP headers - https://github.com/advisories/GHSA-3h5v-q93c-6h6q
fix available via `npm audit fix`
node_modules/whatsapp-web.js/node_modules/ws

5 high severity vulnerabilities

To address all issues, run:
  npm audit fix
root@cognick:~/CaraON-backend# pm2 restart 18
Use --update-env to update environment variables
[PM2] Applying action restartProcessId on app [18](ids: [ '18' ])
[PM2] [caraon-api](18) ‚úì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ id ‚îÇ name              ‚îÇ namespace   ‚îÇ version ‚îÇ mode    ‚îÇ pid      ‚îÇ uptime ‚îÇ ‚Ü∫    ‚îÇ status    ‚îÇ cpu      ‚îÇ mem      ‚îÇ user     ‚îÇ watching ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ 18 ‚îÇ caraon-api        ‚îÇ default     ‚îÇ 1.0.0   ‚îÇ fork    ‚îÇ 622227   ‚îÇ 0s     ‚îÇ 451‚Ä¶ ‚îÇ online    ‚îÇ 0%       ‚îÇ 27.2mb   ‚îÇ root     ‚îÇ disabled ‚îÇ
‚îÇ 0  ‚îÇ whatsapp-agent    ‚îÇ default     ‚îÇ N/A     ‚îÇ fork    ‚îÇ 3836407  ‚îÇ 5D     ‚îÇ 34   ‚îÇ online    ‚îÇ 0%       ‚îÇ 147.0mb  ‚îÇ root     ‚îÇ disabled ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
root@cognick:~/CaraON-backend# pm2 logs 18
[TAILING] Tailing last 15 lines for [18] process (change the value with --lines option)
/root/.pm2/logs/caraon-api-error.log last 15 lines:
18|caraon- |   executionId: '6890d84371de84988c0e54dd'
18|caraon- | }
18|caraon- | Erro ao processar mensagem do WhatsApp: Error: Nenhum agente roteador principal ativo encontrado para a inst√¢ncia 688bd4b9516de24d08819190.
18|caraon- |     at executeHierarchicalAgentFlow (file:///root/CaraON-backend/src/services/agent.execution.service.js:88:13)
18|caraon- |     at async _handleIncomingWhatsAppMessage (file:///root/CaraON-backend/src/services/whatsapp.service.js:88:44) {
18|caraon- |   executionId: '6890d84371de84988c0e54de'
18|caraon- | }
18|caraon- | Erro no fluxo de execu√ß√£o do agente (Execution ID: 6890d84771de84988c0e54df): Error: Nenhum agente roteador principal ativo encontrado para a inst√¢ncia 688bd4b9516de24d08819190.
18|caraon- |     at executeHierarchicalAgentFlow (file:///root/CaraON-backend/src/services/agent.execution.service.js:88:13)
18|caraon- |     at async _handleIncomingWhatsAppMessage (file:///root/CaraON-backend/src/services/whatsapp.service.js:88:44)
18|caraon- | Erro ao processar mensagem do WhatsApp: Error: Nenhum agente roteador principal ativo encontrado para a inst√¢ncia 688bd4b9516de24d08819190.
18|caraon- |     at executeHierarchicalAgentFlow (file:///root/CaraON-backend/src/services/agent.execution.service.js:88:13)
18|caraon- |     at async _handleIncomingWhatsAppMessage (file:///root/CaraON-backend/src/services/whatsapp.service.js:88:44) {
18|caraon- |   executionId: '6890d84771de84988c0e54df'
18|caraon- | }

/root/.pm2/logs/caraon-api-out.log last 15 lines:
18|caraon- | Status da inst√¢ncia 687d6b9e14ab6c1c2623ae4a-1753994425635 atualizado para: CONNECTED
18|caraon- | ‚úâÔ∏è  Mensagem recebida para 687d6b9e14ab6c1c2623ae4a-1753994425635:
18|caraon- | ‚úâÔ∏è  Mensagem recebida para 687d6b9e14ab6c1c2623ae4a-1753994425635:
18|caraon- | ‚úâÔ∏è  Mensagem recebida para 687d6b9e14ab6c1c2623ae4a-1753994425635: Ol√°
18|caraon- | ‚úÖ Servidor WebSocket iniciado
18|caraon- | ‚úÖ Conectado ao MongoDB para sess√µes WhatsApp
18|caraon- | üîÑ Verificando inst√¢ncias para reconex√£o autom√°tica...
18|caraon- | üöÄ API e WebSocket rodando na porta 3030
18|caraon- | üìö Documenta√ß√£o da API dispon√≠vel em: http://localhost:3030/api-docs
18|caraon- | Found 1 instances to reconnect.
18|caraon- | ‚ñ∂Ô∏è Iniciando reconex√£o para a inst√¢ncia: Whats TI (687d6b9e14ab6c1c2623ae4a-1753994425635)
18|caraon- | üöÄ Iniciando inst√¢ncia 687d6b9e14ab6c1c2623ae4a-1753994425635. √â uma reconex√£o? true
18|caraon- | Status da inst√¢ncia 687d6b9e14ab6c1c2623ae4a-1753994425635 atualizado para: RECONNECTING
18|caraon- | ‚úÖ Inst√¢ncia WhatsApp 687d6b9e14ab6c1c2623ae4a-1753994425635 conectada!
18|caraon- | Status da inst√¢ncia 687d6b9e14ab6c1c2623ae4a-1753994425635 atualizado para: CONNECTED

18|caraon-api  | ‚úÖ Inst√¢ncia WhatsApp 687d6b9e14ab6c1c2623ae4a-1753994425635 conectada!
18|caraon-api  | Status da inst√¢ncia 687d6b9e14ab6c1c2623ae4a-1753994425635 atualizado para: CONNECTED
18|caraon-api  | ‚úâÔ∏è  Mensagem recebida para 687d6b9e14ab6c1c2623ae4a-1753994425635: Ol√°!
18|caraon-api  | Erro no fluxo de execu√ß√£o do agente (Execution ID: 6890e503384e2e63754194ba): Error: Nenhum agente roteador principal ativo encontrado para a inst√¢ncia 688bd4b9516de24d08819190.
18|caraon-api  |     at executeHierarchicalAgentFlow (file:///root/CaraON-backend/src/services/agent.execution.service.js:88:13)
18|caraon-api  |     at async _handleIncomingWhatsAppMessage (file:///root/CaraON-backend/src/services/whatsapp.service.js:88:44)
18|caraon-api  | Erro ao processar mensagem do WhatsApp: Error: Nenhum agente roteador principal ativo encontrado para a inst√¢ncia 688bd4b9516de24d08819190.
18|caraon-api  |     at executeHierarchicalAgentFlow (file:///root/CaraON-backend/src/services/agent.execution.service.js:88:13)
18|caraon-api  |     at async _handleIncomingWhatsAppMessage (file:///root/CaraON-backend/src/services/whatsapp.service.js:88:44) {
18|caraon-api  |   executionId: '6890e503384e2e63754194ba'
18|caraon-api  | }




































